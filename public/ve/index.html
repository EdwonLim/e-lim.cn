<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="E-Lim 的写字板">
    <title>E-Lim 的写字板</title>
    <style type="text/css">
        #container {
            width: 100%;
        }
        #editor {
            width: 100%;
            height: 100%;
            font-size: 26px;
        }
    </style>
</head>
<body>
    <div id="container">
        <textarea id="editor"></textarea>
    </div>
    <script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.js"></script>
    <script>
        speechSynthesis.getVoices(); // 新调用一次，第二次调，才有结果。
        const keyList = [' ', '\n', ':', '：', ',', '，', '.', '。'];
        let prevLength = 0;
        $(() => {
            $('#container').height(window.innerHeight / 2);
            $('#editor').focus();
            $('#editor').on('input', () => {
                const text = $('#editor').val();
                const last = text[text.length - 1];
                if (text.length < prevLength) {
                    prevLength = text.length;
                } else if (keyList.indexOf(last) > -1) {
                    const msg = new SpeechSynthesisUtterance(text.slice(prevLength)); 
                    msg.voice = speechSynthesis.getVoices().filter((voice) => voice.lang.indexOf('zh-CN') > -1)[1];
                    speechSynthesis.speak(msg); 
                    prevLength = text.length;
                }
            });
        });
    </script>
</body>

</html>